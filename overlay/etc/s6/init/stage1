#!/usr/bin/execlineb -P

cd /
umask 022
fdclose 0
fdclose 1
fdclose 2

redirfd -r 0 /dev/null
mkdir -p /var/s6/
redirfd -wnb 1 /var/s6/fifo # (black magic: doesn't block)
fdmove -c 2 1

background
{
    s6-setsid
    redirfd -w 1 /var/s6/fifo # (blocks until the logger reads)
    forbacktickx i { ls /etc/s6/task }
    import i
    exec /etc/s6/task/${i}
}
unexport LASTPID

s6-envdir /etc/s6/env
s6-svscan -t0 /etc/s6/service

